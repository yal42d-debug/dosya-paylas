name: Build Android APK
on:
  push:
      branches:
            - main
              workflow_dispatch:

              jobs:
                build:
                    runs-on: ubuntu-latest
                        steps:
                              - uses: actions/checkout@v3

                                    - name: Setup Java
                                            uses: actions/setup-java@v3
                                                    with:
                                                              distribution: 'temurin'
                                                                        java-version: '17'

                                                                              - name: Setup Node.js
                                                                                      uses: actions/setup-node@v3
                                                                                              with:
                                                                                                        node-version: 18
                                                                                                        
                                                                                                              - name: Install Cordova
                                                                                                                      run: npm install -g cordova
                                                                                                                      
                                                                                                                            - name: Add Android Platform
                                                                                                                                    run: |
                                                                                                                                              cd mobile-app
                                                                                                                                                        cordova platform add android
                                                                                                                                                        
                                                                                                                                                              - name: Add Node.js Mobile Plugin
                                                                                                                                                                      run: |
                                                                                                                                                                                cd mobile-app
                                                                                                                                                                                          cordova plugin add cordova-plugin-nodejs-mobile
                                                                                                                                                                                          
                                                                                                                                                                                                - name: Install Node Modules for Backend
                                                                                                                                                                                                        run: |
                                                                                                                                                                                                                  cd mobile-app/www/nodejs-project
                                                                                                                                                                                                                            npm install
                                                                                                                                                                                                                            
                                                                                                                                                                                                                                  - name: Build APK (Release)
                                                                                                                                                                                                                                          run: |
                                                                                                                                                                                                                                                    cd mobile-app
                                                                                                                                                                                                                                                              cordova build android --release
                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                    - name: Upload APK
                                                                                                                                                                                                                                                                            uses: actions/upload-artifact@v3
                                                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                                                              name: app-release
                                                                                                                                                                                                                                                                                                        path: mobile-app/platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk
                                                                                                                                                                                                                                                                                                        
